
<!DOCTYPE html>
<html lang="fr">
<head> <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3DZND035Y"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-R3DZND035Y');
</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Guild Wars 2 Stats Tracker — MVP</title>
  <style>
    :root { --bg:#0f1419; --panel:#151b22; --muted:#9aa4af; --text:#e8edf2; --accent:#8bd3ff; --good:#35d07f; --warn:#ffcf5c; --bad:#ff6b6b; }
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text)}
    header{padding:20px;border-bottom:1px solid #1f2730;background:linear-gradient(180deg,#121922,#0f1419)}
    h1{margin:0;font-size:22px} .wrap{max-width:1100px;margin:0 auto;padding:20px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .card{grid-column:span 12;background:var(--panel);border:1px solid #1f2730;border-radius:12px;padding:16px}
    @media(min-width:900px){
      .span6{grid-column:span 6} .span4{grid-column:span 4} .span8{grid-column:span 8}
    }
    h2{font-size:16px;margin:0 0 12px 0;color:#cfe6ff}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    input,button{background:#0e131a;border:1px solid #243142;color:var(--text);border-radius:8px;padding:10px 12px}
    input{flex:1;min-width:240px} button{cursor:pointer}
    table{width:100%;border-collapse:collapse} th,td{padding:8px 10px;border-bottom:1px solid #243142}
    th{text-align:left;color:var(--muted);font-weight:600} tr:hover td{background:#0f1620}
    .muted{color:var(--muted)} .pill{padding:2px 8px;border-radius:999px;border:1px solid #2b3a4d;color:#cfe6ff;font-size:12px}
    .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
    .kpi{display:flex;gap:16px;flex-wrap:wrap}
    .kpi .box{background:#0e131a;border:1px solid #243142;border-radius:10px;padding:12px 14px;min-width:140px}
    .box .label{color:var(--muted);font-size:12px} .box .value{font-size:18px;margin-top:4px}
    .small{font-size:12px}
    .sep{height:1px;background:#1f2730;margin:12px 0}
    .note{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="wrap row" style="justify-content:space-between">
      <h1>GW2 Stats Tracker — MVP</h1>
      <span class="pill">API officielle v2</span>
    </div>
  </header>

  <div class="wrap grid">
    <div class="card span12">
      <h2>Clé API</h2>
      <div class="row">
        <input id="apiKey" placeholder="Colle ici ta clé API Guild Wars 2" />
        <button id="loadWallet">Charger le portefeuille</button>
        <span id="status" class="muted small"></span>
      </div>
      <div class="note">Crée une clé sur account.arena.net → Applications. Coche : account, inventories, characters, wallet, tradingpost, progression.</div>
    </div>

    <div class="card span6">
      <h2>Portefeuille</h2>
      <table id="walletTable">
        <thead>
          <tr>
            <th>Icône</th>
            <th>Nom</th>
            <th>Quantité</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const apiKeyInput = document.getElementById('apiKey');
      const loadBtn = document.getElementById('loadWallet');
      const statusEl = document.getElementById('status');
      const tableBody = document.querySelector('#walletTable tbody');

      loadBtn.addEventListener('click', async () => {
        const apiKey = apiKeyInput.value.trim();
        if (!apiKey) {
          alert("Merci de saisir ta clé API !");
          return;
        }

        statusEl.textContent = "Chargement...";

        try {
          // 1️⃣ Charger la liste des devises publiques
          const currenciesIds = await fetch('https://api.guildwars2.com/v2/currencies').then(r => r.json());
          const currenciesData = await fetch(`https://api.guildwars2.com/v2/currencies?ids=${currenciesIds.join(',')}`).then(r => r.json());

          // 2️⃣ Charger le portefeuille du joueur
          const walletResp = await fetch('https://api.guildwars2.com/v2/account/wallet', {
            headers: { 'Authorization': `Bearer ${apiKey}` }
          });
          if (!walletResp.ok) throw new Error("Clé API invalide ou problème de connexion.");
          const walletData = await walletResp.json();

          // 3️⃣ Associer et afficher
          tableBody.innerHTML = '';
          walletData.forEach(entry => {
            const info = currenciesData.find(c => c.id === entry.id);
            if (!info) return;
            const row = document.createElement('tr');
            row.innerHTML = `
              <td><img src="${info.icon}" alt="${info.name}" width="32"></td>
              <td>${info.name}</td>
              <td>${entry.value.toLocaleString()}</td>
            `;
            tableBody.appendChild(row);
          });

          statusEl.textContent = "Données à jour ✅";

        } catch (err) {
          console.error(err);
          statusEl.textContent = "Erreur : " + err.message;
        }
      });
    });
  </script>
</body>
</html>
